function make_sound(){for(var t=new Tone.PolySynth(3,Tone.Synth,{oscillator:{type:oscillatorTypeName,count:3,spread:30},envelope:{attack:.01,decay:.1,sustain:.5,release:.4,attackCurve:"exponential"}}).toMaster(),e=[],a=0,n=Tone.now(),r=1;r<transmitanceHit.length;r++){var o=transmitanceHit[r].transmitance,l={note:new Tone.Frequency(transmitanceHit[r].frequency,"midi").toNote(),time:o};e.push(l),a+=o}var c=new Tone.Part(function(e,a){t.triggerAttackRelease(a.note,n+a.time,e,1)},e);c.start(n),c.stop(n+a),Tone.Transport.start()}function filter_JDX_data(t){molecule_ir_data=new Array;for(var e=t.split("\n"),a=0;a<e.length-1;a++)if(void 0!==typeof e[a]&&""!==e[a]){var n=e[a].charAt(0);if(n%1==0){var r=e[a].split(" ");molecule_ir_data.push({frequency:parseFloat(r[0]),value:parseFloat(r[1])})}else{var o=document.getElementById("data-comments"),l=document.getElementById("comment-source-file-modal"),c=document.createElement("p"),s=document.createElement("p");"#"==n?(a<9&&(c.innerHTML=e[a].substring(2)),s.innerHTML=e[a].substring(2)):(a<9&&(c.innerHTML=e[a].substring(2)),s.innerHTML=e[a]),o.append(c),l.appendChild(s)}}transmitanceHit=getTransmitanceHit(molecule_ir_data),chart_this(molecule_ir_data),make_sound(transmitanceHit)}function getTransmitanceHit(t){for(var e=document.getElementById("transmitanceThreshold").value/1e3,a=Array.prototype.slice.call(t),n=[],r=1;r<a.length;r++)if(a[r].value>a[r-1].value+e||a[r].value<a[r-1].value-e){var o={transmitance:a[r].value,frequency:a[r].frequency};n.push(o)}return n}function chart_this(t){var e=Array.prototype.slice.call(t),a=document.getElementById("canvas-wrapper"),n=document.getElementsByClassName("button")[0],r=document.defaultView.getComputedStyle(n,null).getPropertyValue("background-color");e.forEach(function(t){t.frequency=t.frequency,t.value=t.value});var o={top:20,right:30,bottom:30,left:40},l=a.offsetWidth-o.left-o.right,c=a.offsetHeight-o.top-o.bottom,s=d3.scaleLinear().rangeRound([l,0]),i=d3.scaleLinear().rangeRound([c,0]),d=d3.area().x(function(t){return s(t.frequency)}).y1(function(t){return i(t.value)}),u=d3.select("body #canvas-wrapper").insert("svg").attr("class","area-chart").datum(e).attr("width",l+o.left+o.right).attr("height",c+o.top+o.bottom).append("g").attr("transform","translate("+o.left+","+o.top+")");s.domain([e[0].frequency,e[e.length-1].frequency]),i.domain([0,d3.max(e,function(t){return t.value})]),d.y0(i(0)),u.append("linearGradient").attr("id","temperature-gradient").attr("gradientUnits","userSpaceOnUse").attr("x1",0).attr("y1",i(0)).attr("x2",l).attr("y2",i(1)).selectAll("stop").data([{offset:"0%",color:r},{offset:"50%",color:r},{offset:"100%",color:r}]).enter().append("stop").attr("offset",function(t){return t.offset}).attr("stop-color",function(t){return t.color}),u.append("path").data([e]).attr("class","area").attr("d",d),u.append("g").attr("class","grid").attr("transform","translate(0,"+c+")").call(function(){return d3.axisBottom(s).ticks(5)}().tickSize(-c).tickFormat("")),u.append("g").attr("transform","translate(0,"+c+")").call(d3.axisBottom(s)).attr("class","axisWhite").append("text").attr("transform","translate("+(l-60)+", -10)").attr("class","legend").text("Wavelength"),u.append("g").call(d3.axisLeft(i)).attr("class","axisWhite").append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy","0.71em").attr("text-anchor","end").attr("class","legend").text("Transmitance")}var oscillatorTypeDropdown=document.getElementById("oscillator-type-dropdown"),oscillatorsType=Array.prototype.slice.call(oscillatorTypeDropdown.getElementsByClassName("link")),oscillatorTypeLabel=document.getElementById("current-oscillator-type"),oscillatorTypeName=null;oscillatorsType.forEach(function(t){t.addEventListener("click",function(t){var e=this.getAttribute("data-oscillator");oscillatorTypeLabel.innerHTML=e,make_sound()},!1)}),oscillatorTypeName||(oscillatorTypeName="sine",oscillatorTypeLabel.innerHTML=oscillatorTypeName);var dropdowns=Array.prototype.slice.call(document.getElementsByClassName("dropdown-button"));dropdowns.forEach(function(t){var e=Array.prototype.slice.call(document.getElementsByClassName("link"));t.addEventListener("click",function(t){t.preventDefault();var e=this.parentElement.id;document.getElementById(e).classList.toggle("active")},!1),e.forEach(function(t){t.addEventListener("click",function(t){t.preventDefault();var e=this.parentElement.parentElement.parentElement.parentElement.id;console.log(e),document.getElementById(e).classList.remove("active")})})});var molecule_ir_data=new Array,transmitanceHit=[],moleculeDropdown=document.getElementById("molecule-dropdown");get_JDX_data=function(t,e,a){var n=new XMLHttpRequest;n.onreadystatechange=function(){n.readyState===XMLHttpRequest.DONE&&(200===n.status?e&&e(n.responseText):a&&a(n))},n.open("GET",t,!0),n.send()};var molecules_entry=Array.prototype.slice.call(moleculeDropdown.getElementsByClassName("link"));molecules_entry.forEach(function(t){t.addEventListener("click",function(t){var e=this.getAttribute("data-file");document.getElementById("canvas-wrapper").innerHTML="",document.getElementById("data-comments").innerHTML="",get_JDX_data(e,filter_JDX_data)},!1)}),get_JDX_data("data/7732-18-5-IR.jdx",filter_JDX_data);var modalButtons=Array.prototype.slice.call(document.getElementsByClassName("modal-button"));modalButtons.forEach(function(t){t.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("data-toggle");console.log(e),document.getElementById(e).classList.toggle("active")},!1)});